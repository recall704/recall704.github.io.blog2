<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>K8s</title>
  <meta property="og:title" content="K8s" />
  <meta name="twitter:title" content="K8s" />
  <meta name="author" content=""/>
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://www.recall704.com/tags/k8s/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="RECALL&#39;s Blog" />

  <meta name="generator" content="Hugo 0.32.2" />
  <link rel="canonical" href="http://www.recall704.com/tags/k8s/" />
  <link rel="alternate" href="http://www.recall704.com/index.xml" type="application/rss+xml" title="RECALL&#39;s Blog">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://www.recall704.com/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://www.recall704.com/css/pygment_highlights.css" />
  <link rel="stylesheet" href="http://www.recall704.com/css/highlight.min.css" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.recall704.com/">RECALL&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="home" href="/">home</a>
            </li>
          
        
          
            <li>
              <a title="tags" href="/tags/">tags</a>
            </li>
          
        
          
            <li>
              <a title="categories" href="/categories/">categories</a>
            </li>
          
        
          
            <li>
              <a title="series" href="/series/">series</a>
            </li>
          
        
          
            <li>
              <a title="about" href="/about/">about</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
      </div>
    </div>

  </div>
</nav>




    
  <header class="header-section ">
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="page-heading">
              <h1>#K8s</h1>
              <hr class="small">
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

    
  <div class="container" role="main">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <div class="posts-list">
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/k8s-authentication-with-basic/">
                <h2 class="post-title">创建 client （三）： HTTP Basic Auth 访问 k8s API Server</h2>

                
              </a>

              <p class="post-meta">
                Posted on April 15, 2018
              </p>
              <div class="post-entry">
                
                  0x01 结构体 AuthInfo 如果你留意过上一篇文章，你会发现一个结构体
AuthInfo: clientcmdapi.AuthInfo{ ClientCertificate: &quot;client.crt&quot;, ClientKey: &quot;client.key&quot;, },  其对应代码在 client-go 下的 k8s.io/client-go/tools/clientcmd/api 中
type AuthInfo struct { // LocationOfOrigin indicates where this object came from. It is used for round tripping config post-merge, but never serialized. LocationOfOrigin string // ClientCertificate is the path to a client cert file for TLS. // +optional ClientCertificate string `json:&quot;client-certificate,omitempty&quot;` // ClientCertificateData contains PEM-encoded data from a client cert file for TLS.
                  <a href="http://www.recall704.com/cloud/k8s-authentication-with-basic/" class="post-read-more">[Read More]</a>
                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/client/">client</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/basic/">basic</a>&nbsp;
                  
                </span>
              

            </article>
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/k8s-authentication-with-ca/">
                <h2 class="post-title">创建 client （二）： 通过配置文件方式访问 k8s API</h2>

                
              </a>

              <p class="post-meta">
                Posted on April 15, 2018
              </p>
              <div class="post-entry">
                
                  0x01 概述 前面我讲过集群内通过 ServiceAccount 生成 token 的方式访问 k8s API Server， 那么如果我们要访问 k8s api 的应用不是跑在 k8s 之内，而是在 k8s 集群之外运行呢？
这个时候，我们还有两种认证方式
 ca 证书认证
 basic 认证  0x02 kubectl 是如何访问 k8s 的？ k8s 部署的时候，我们会给 kubectl 配置证书，context 等信息，生成一个 $HOME/.kube/config 这样的文件，文件内容如下 apiVersion: v1 clusters: - cluster: certificate-authority-data: ... server: https://192.168.1.200:6443 name: kube_cluster contexts: - context: cluster: kube_cluster namespace: kube-system user: kubectl name: kubectl@kube_cluster current-context: kubectl@kube_cluster kind: Config preferences: {} users: - name: kubectl user: as-user-extra: {} client-certificate-data: .
                  <a href="http://www.recall704.com/cloud/k8s-authentication-with-ca/" class="post-read-more">[Read More]</a>
                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/client/">client</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/config/">config</a>&nbsp;
                  
                </span>
              

            </article>
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/k8s-operator/">
                <h2 class="post-title">k8s operator 简介</h2>

                
              </a>

              <p class="post-meta">
                Posted on April 13, 2018
              </p>
              <div class="post-entry">
                
                  0x1 Operator 介绍 Operator 是 CoreOS 公司提出的一个概念，用来创建、配置、管理复杂应用，由两部分构成：
 1. Resource
 1.1 自定义资源
 1.2 为用户提供一种简单的方式描述对服务的期望
  2. Controller
 2.1 创建 Resource
 2.2 监听 Resource 的变更，用来实现用户对服务的期望
   0x2 Operator 工作流程  1. 注册自定义资源 CustomResource
 2. 监听(watch)自定义资源
 3. 用户对自定义进行 CREATE/UPDATE/DELETE 操作
 4. 当监听到资源变化之后，调用对应的 handler 进行处理
  如果你了解 k8s 的内部原理，你会发现其实 k8s 本身就是这样做的，
比如 deployment ，只是 deployment 资源是内置资源，
不用向 APIServer 进行注册了而已，deployment controller 会对资源进行监控和处理。
                  <a href="http://www.recall704.com/cloud/k8s-operator/" class="post-read-more">[Read More]</a>
                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/operator/">operator</a>&nbsp;
                  
                </span>
              

            </article>
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/k8s-authentication-with-token/">
                <h2 class="post-title">创建 client （一）： token 方式访问 k8s API</h2>

                
              </a>

              <p class="post-meta">
                Posted on April 11, 2018
              </p>
              <div class="post-entry">
                
                  0x1 概述 k8s 提供了三种认证方式访问 API Server，分别是：
1. ca 认证 k8s 的各个组件，比如 kubelet, kube-proxy 和 API Server 进行通信的时候，一般都是使用证书的形式，配置在 kubeconfig 文件中。
2. token 认证 rook （https://github.com/rook/rook） 、dashboard （https://github.com/kubernetes/dashboard） 这些应用，跑在 k8s 集群内，而且需要访问 k8s 的资源， 运行的时候需要指定 ServiceAccount ，ServiceAccount 又配置了指定的角色和权限。
3. http basic 认证 使用用户名和密码访问 k8s，稍后会有新的文章详细介绍。
0x2 token 认证详解 像 rook、dashboard 这样的应用，它是怎样通过 ServiceAccount 和 k8s API Server 进行通信的呢？
和 k8s API Server 通信需要创建 client， 而创建 client 需要对应的 配置信息（包含了 API Server 的地址和端口，以及认证信息）
我们在 rook 的代码中，可以看到下面这样类似的代码
                  <a href="http://www.recall704.com/cloud/k8s-authentication-with-token/" class="post-read-more">[Read More]</a>
                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/client/">client</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/token/">token</a>&nbsp;
                  
                </span>
              

            </article>
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/k8s-node-roles/">
                <h2 class="post-title">k8s 中 node 的 roles</h2>

                
              </a>

              <p class="post-meta">
                Posted on March 14, 2018
              </p>
              <div class="post-entry">
                
                  <p>部署 k8s 之后，get nodes 可能会发现 node 上有个 ROLES</p>

<p><img src="/static/images/15210086580054.jpg" alt="" /></p>

<p>但是执行命令：</p>

<pre><code>kubectl get nodes 192.168.88.201 -o yaml
</code></pre>

<p>在里面却没有发现有 ROLES 这样的字段？</p>

<p>那我们如果要给 node 添加对应的 ROLE 到底要怎么做呢？</p>

<p><img src="/static/images/15210089063257.jpg" alt="" /></p>

<p>通过代码，我们可以知道，k8s 把 label
<code>node-role.kubernetes.io/&lt;role&gt;=&quot;&quot;</code> 和
<code>kubernetes.io/role=&quot;&lt;role&gt;&quot;</code>
来定义角色。</p>

<p>所以 master 可以这样</p>

<pre><code>kubectl label node 192.168.88.201 node-role.kubernetes.io/master=true
</code></pre>

<p>或者</p>

<pre><code>kubectl label node 192.168.88.201 kubernetes.io/role=master
</code></pre>

                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/node/">node</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/roles/">roles</a>&nbsp;
                  
                </span>
              

            </article>
          
            <article class="post-preview">
              <a href="http://www.recall704.com/cloud/taint-and-toleration/">
                <h2 class="post-title">k8s 中的污染 Taint 与容忍 Toleration</h2>

                
              </a>

              <p class="post-meta">
                Posted on March 11, 2018
              </p>
              <div class="post-entry">
                
                  之前的内部分享中我提到过，pod 最终会被调度到某个具体的 node 上运行。那么有没有某种方式，限制 pod，不让它在某些 node 上运行呢？ 或者说，只允许某些 pod 在某些 node 上运行呢？  taint 和 toleration 了解一下。
 一、 taint （污染） 首先一点，taint 是针对 node 而言的，给 node 增加 taint 的命令如下
kubectl taint nodes node1 aaa=bbb:NoSchedule  其中：
1. aaa 代表 taint 的 key
2. bbb 代表 taint 的 value
3. NoSchedule 代码这个 taint 对应的影响，它可以有三个值
   值 含义     NoSchedule 不允许新的 pod 调度到该 node 上，除非 toleration 条件满足；不影响已经运行在该 node 上的 pod   PreferNoSchedule 尽可能不要调度到该 node 上，除非 toleration 条件满足；不影响已经运行在该 node 上的 pod   NoExecute 驱逐该节点上的 pod 到其它节点，除了 toleration 条件满足的 pod；影响已经运行在该 node 上的所有 pod    我们了解到一点，那就是增加了 taint 的 node，pod 就不会调度到它上面运行了。
                  <a href="http://www.recall704.com/cloud/taint-and-toleration/" class="post-read-more">[Read More]</a>
                
              </div>

              
                <span class="post-meta">
                  
                    #<a href="http://www.recall704.com/tags/k8s/">k8s</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/taint/">taint</a>&nbsp;
                  
                    #<a href="http://www.recall704.com/tags/toleration/">toleration</a>&nbsp;
                  
                </span>
              

            </article>
          
        </div>
        
      </div>
    </div>
  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          
          &nbsp;&bull;&nbsp;
          2018

          
            &nbsp;&bull;&nbsp;
            <a href="http://www.recall704.com/">RECALL&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.32.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://www.recall704.com/js/main.js"></script>
<script src="http://www.recall704.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
<script src="http://www.recall704.com/js/load-photoswipe.js"></script>



  </body>
</html>

